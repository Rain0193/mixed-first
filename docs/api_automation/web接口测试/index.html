<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>接口测试－WEB接口常见的实现方法 - 自动化测试</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  

  
  <link rel="stylesheet" href="../../css/fonts.css" type="text/css" />

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "接口测试－WEB接口常见的实现方法";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> 自动化测试</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">主页</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>QuickStart</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../webui_automation/project_structure/">项目结构和配置</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/selenium_in_a_wild_way/">WEB页面自动化-SELENIUM管理页面元素</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../webui_automation/webui_automation_quickstart/">WEB页面自动化-开始</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../webui_automation/webui_automation_realexample/">WEB页面自动化-真实用例</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../APIAutomation/">API 自动化测试</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../api_testing_qa/">API 自动化测试常见问题</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../activity_automation/activity_automation_defined_employees/">工作流测试之指定审批节点</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../activity_automation/activity_automation_dynamic/">工作流测试之动态审批节点</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>自动化测试模块介绍</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../intro/automation-purpose/">目的</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../intro/automation-framework-impl/">基本模块的作用</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../webui_automation/self_defined_elements/">页面自动化-页面元素的使用</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../webui_automation/element_handler/">页面自动化-页面元素方法查询</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../webui_automation/pageobject_codegenerator/">页面自动化-页面代码生成</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../webui_automation/build_test/">页面自动化-WebTestActionBuilder</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>接口自动化测试</span></li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">接口测试－WEB接口常见的实现方法</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#web-">web接口自动化测试－了解接口一般实现方法</a></li>
                
                    <li><a class="toctree-l4" href="#web">WEB接口常见实现的分析</a></li>
                
                    <li><a class="toctree-l4" href="#web_1">WEB 接口常见的实现代码分析</a></li>
                
                    <li><a class="toctree-l4" href="#http-">HTTP参考- 可以让你更多的了解一下关于接口定义的一些细节</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../APIAutomation/">API 自动化测试</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../API自动化测试-进阶/">API自动化测试-进阶</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Tips</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/WebTest_Debug/">WebUI Debug</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/find_by_ref/">FindByRef annotation  使用</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../best_practice/verification_annotation/">verification 注解使用</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../best_practice/code_style/">JAVA 自动化测试代码规范</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../best_practice/simple_ui_case/">一个简单测试用例的自动化实例</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../database/Database/">数据库操作</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/testng-xml-configuration/">TestNG 测试XML配置</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/use_own_password/">使用自己的用户名和密码获取万能密码</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/JsonHelper/">JSON处理</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/page_object/">Page Object/Page Factory</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/TreeElement/">TreeElement 使用</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/WebDriverHelper/">添加了Expectation的WebDriver操作</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/WebDriver操作/">WebDriver原生操作</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/how_to_write_teststeps/">编写测试步骤的不同方法</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/repeatable_elements/">重复填写控件使用</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/StateElementReferneceException/">StateElementReferneceException</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/DateHelper/">DateHelper</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/database_assetion/">数据库验证</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/database_update/">预设条件数据的更新和回滚</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/testng_faq/">TestNG测试常见问题</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/simplest_testngreport/">TestNG 定制报表简单原理</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/PageFactory/">Page Factory 模式原理</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/random_data/">随机数据</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tips/data_construct_by_context/">动态测试数据构建</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Git</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../git/git_basic/">Git 基础</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">自动化测试</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>接口自动化测试 &raquo;</li>
        
      
    
    <li>接口测试－WEB接口常见的实现方法</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="web-">web接口自动化测试－了解接口一般实现方法</h1>
<p>对于一般的web应用来说,一个接口往往代表了一个对外提供执行业务的服务,使得客户端和服务端可以进行交互.常见的有两大类</p>
<ul>
<li>HTTP/HTTPS 协议的接口</li>
<li>WEB SERVICE 接口如SOAP,RMI,RPC等协议</li>
</ul>
<p>从广义上讲,目前最主要使用场景主要有两类:</p>
<ul>
<li>访问API接口(HTTP-based)获取JSON格式的数据</li>
<li>访问API接口(HTTP-based)获取服务端已经渲染好的HTML数据</li>
</ul>
<h2 id="web">WEB接口常见实现的分析</h2>
<p>一下内容主要是介绍一些当前系统常见的一些实现方法，以便测试对于系统结构有个大致的印象.</p>
<p>以下是一个常见的从客户端请求到服务端返回请求的过程:
<img alt="img" src="../../pics/mvc_intro.jpg" /></p>
<h2 id="web_1">WEB 接口常见的实现代码分析</h2>
<p>了解一下大概的代码结构可以更加清楚被测对象，抛开所有框架层面的东西，在一个MVC架构的系统中去了解某个业务如何实现，一般就是从Controller开始，
controller会连接客户请求，业务逻辑处理，以及实际的返回。</p>
<p>下面是一个简单的Controller实现的讲解:</p>
<ul>
<li>实例代码：</li>
</ul>
<pre><code class="java">@Controller
@RequestMapping(&quot;/api/fy&quot;)
public class ApiForPropertyDescController extends BaseController {

    @ResponseBody
    @RequestMapping(value = &quot;/pictureDesc/show/{propertyId}&quot;, method = RequestMethod.GET)
    public String showPictureDesc(@PathVariable String propertyId,
            @RequestParam(required = false,value = &quot;empNo&quot;) String empNo)
            throws Exception {

        Map&lt;String, Object&gt; resultMap = new HashMap&lt;&gt;();

        Integer empId = Integer.valueOf(empNo);
        List&lt;PropertyPictureView&gt; lstPropPic = fyPropertyDescVoteService.getPropertyDescPictureWithoutHouseLayout(empId, propertyId);
        List&lt;Map&lt;String,Object&gt;&gt; resultListMap = filterPropertyPicture(lstPropPic);
        resultMap.put(&quot;descPicturs&quot;, resultListMap);
//      resultMap.put(&quot;mediaBase&quot;, ResourceMap.get(&quot;pic_root&quot;));
        return new ObjectMapper().writeValueAsString(resultMap);
    }
}
</code></pre>

<p>以上的代码会处理请求：http://fy.Domain.org/api/fy/pictureDesc/123456643</p>
<p>从代码角度来分析一下以上代码注解的一些使用:</p>
<ul>
<li>类级别的路径@RequestMapping("/api/fy")和方法级别的路径</li>
<li>方法级别的路径@RequestMapping(value = "/pictureDesc/show/{propertyId}" 结合：这个接口的路径是/api/fy/pictureDesc/show/{propertyId} {propertyId}实际上是个占位符，最后会被实际的值替代，也就是他其实自动化测试框架里面JSON描述文件中的<code>pathParameter</code></li>
<li>从method=RequestMethod.GET得到这是个GET的请求</li>
<li>从@PathVariable，说明请求中会有一个propertyId的参数，这个参数是通过替换掉{propertyId}的值，传递到函数累不的</li>
<li>从@RequestParam 说明请求中还有又一个是empNo的参数，也就是自动化测试框架中的queryParameter，他是加载URL后面的，格式就是&amp;key=value</li>
<li>header没有特殊的说明，所以这个请求的Content-Type可以使用application/x-www-form-urlencoded
  如果header有特殊说明如下:</li>
</ul>
<pre><code class="java">    @ResponseBody
    @RequestMapping(value = &quot;/pictureDesc/show/{propertyId}&quot;,
            consumes = MediaType.APPLICATION_JSON_VALUE,
            produces = MediaType.APPLICATION_JSON_VALUE,
            method = RequestMethod.GET)
    public String showPictureDesc(@PathVariable String propertyId,
            @RequestParam(required = false,value = &quot;empNo&quot;) String empNo)
</code></pre>

<p>那么这个时候表示这个接口：</p>
<ul>
<li>只接受包体有JSON的请求(consumes = MediaType.APPLICATION_JSON_VALUE)</li>
<li>生产有JSON包体的返回(produces = MediaType.APPLICATION_JSON_VALUE)</li>
<li>方法上有@ReponseBody，表示这个方法的返回，会在response 的包体中</li>
</ul>
<p>和目前自动化测试框架结合可以得到如下:</p>
<pre><code>通过这个接口定义我们可以得到如下的接口描述文件：
{
  &quot;queryParameters&quot;:[&quot;empNo&quot;
  ],
  &quot;pathParameters&quot;:[&quot;propertyId&quot;],
  &quot;method&quot;:&quot;GET&quot;,
  &quot;resourceURL&quot;:&quot;/api/fy/pictureDesc/show/{propertyId}&quot;,
  &quot;contentType&quot;:&quot;application/x-www-form-urlencoded&quot;,
  &quot;headers&quot;:{}
  &quot;apiDomain&quot;:&quot;fy&quot;  
}
</code></pre>

<ul>
<li>如果对于以上代码继续挖掘的话，你可以发现主要实现的业务逻辑的代码如下：</li>
</ul>
<pre><code class="java">  List&lt;PropertyPictureView&gt; lstPropPic = fyPropertyDescVoteService.getPropertyDescPictureWithoutHouseLayout(empId, propertyId);
  List&lt;Map&lt;String,Object&gt;&gt; resultListMap = filterPropertyPicture(lstPropPic);
</code></pre>

<p>fyPropertyDescVoteService 是具体处理业务逻辑的地方，而且一般都会和数据库或者缓存打交道.通过再往下面追查，其实我们其实可以发现有些接口的逻辑其实是比较简单的，有些会复杂一点.
所以通过一些代码走查，大概也可以了解大概的业务复杂度，同时也能了解有关系的一些数据库的表,从而可以对整个功能有更全面的一些了解.
一般情况下在service类里面有会调用DAO(Data Access Object)的方法，而一般一个DAO的方法会有一个存放sql的XML对应，比如下例:</p>
<pre><code class="java">@Repository
public class PropertyDescVoteDao extends BaseDao{

    public void update(PropertyDescVote propertyDescVote){
        sqlSession.update(&quot;PropertyDescVoteMapper.update&quot; , propertyDescVote);
    }
}
</code></pre>

<p>其中PropertyDescVoteMapper.xml就是这个DAO对应存放sql的位置,update 就是对应到xml文件的id，如下例:</p>
<pre><code class="java">
    &lt;update id=&quot;update&quot; parameterType=&quot;PropertyDescVote&quot;&gt;
        update  PropertyDescVote
        &lt;set&gt;
            &lt;if test=&quot;empNo!=null&quot;&gt;
                empNo= #{empNo} ,
            &lt;/if&gt;        
            &lt;if test=&quot;score!=null&quot;&gt;
                score= #{score},
            &lt;/if&gt;
            &lt;if test=&quot;voteEmpNo!=null&quot;&gt;
                voteEmpNo= #{voteEmpNo},
            &lt;/if&gt;
            &lt;if test=&quot;status!=null&quot;&gt;
                status= #{status},
            &lt;/if&gt;
            &lt;if test=&quot;flag!=null&quot;&gt;
                flag= #{flag},
            &lt;/if&gt;
            &lt;if test=&quot;remark!=null&quot;&gt;
                remark= #{remark},
            &lt;/if&gt;
            &lt;if test=&quot;votedAt!=null&quot;&gt;
                votedAt= #{votedAt},
            &lt;/if&gt;
            &lt;if test=&quot;completedAt!=null&quot;&gt;
                completedAt= #{completedAt},
            &lt;/if&gt;
            &lt;if test=&quot;votingEmpNo!=null&quot;&gt;
                votingEmpNo= #{votingEmpNo},
            &lt;/if&gt;
            &lt;if test=&quot;isPhotographer!=null&quot;&gt;
                isPhotographer= #{isPhotographer},
            &lt;/if&gt;
            updatedAt= getDate(),
        &lt;/set&gt;
        where  id = #{id}
    &lt;/update&gt;
</code></pre>

<ul>
<li>直接返回页面的实现</li>
</ul>
<p>有些实现比如:</p>
<pre><code class="java">@Controller
@RequestMapping(value = &quot;/fy/zrManagerForEstate&quot;)
public class ZrManagerForEstateController extends BaseController {
    @Autowired
    private ZrManagerForEstateService zrManagerForEstateService;
    @Autowired
    private FyPropertyService fyPropertyService;

    @RequestMapping(method = RequestMethod.GET)
    public String showView(HttpServletRequest request) throws Exception {
                PortalEmployee portalEmployee = super.getSessionUser(request);
                //验证权限
                if(!AuthFunctions2.hasFuncAuth(portalEmployee, IAuth.功能权限_自如管家配盘)){
                     return &quot;fy/common/no_access&quot;;
                }
        return &quot;fy/zrManager/index&quot;;
    }
}
</code></pre>

<p>这些代码里面基本上和之前的代码一样，不同的是最后返回:</p>
<pre><code class="java"> return &quot;fy/zrManager/index&quot;;
</code></pre>

<p>这样的返回表示返回了一个页面，也就是html 而不是json， 这个html的模版所在位置一般是在webapp/WEB-INF/jsp/fy/zrManager/index.jsp</p>
<p>至此我们常见的HTTP接口代码实现就介绍完了,后面会针对如何进行此类API测试更详细的介绍,不过我们总结以上的代码实现的话，对于一个接口测试需要测试的包括但不限于:
- 接口(contract)是否按照需求文件来实现的
- 具体的业务逻辑一般都会涉及到数据库操作，数据库内容如何是否校验
- 返回值是否按照接口需求文档实现的
- .......</p>
<p>思考问题:那么如果每一个接口都需要登录验证会怎么办呢？</p>
<h2 id="http-">HTTP参考- 可以让你更多的了解一下关于接口定义的一些细节</h2>
<ul>
<li><a href="http://qa.baidu.com/blog/?p=1299">HTTP 协议浅析</a></li>
<li><a href="https://biezhi.me/article/http-request-message.html">HTTP 请求报文解析</a></li>
<li><a href="https://en.wikipedia.org/wiki/List_of_HTTP_header_fields">HTTP Headers</a></li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../APIAutomation/" class="btn btn-neutral float-right" title="API 自动化测试"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../webui_automation/build_test/" class="btn btn-neutral" title="页面自动化-WebTestActionBuilder"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../../webui_automation/build_test/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../APIAutomation/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
